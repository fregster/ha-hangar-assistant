# --- HANGAR ASSISTANT CONSOLIDATED GLASS COCKPIT (v2601.1) ---
# NOTE: This template uses placeholder slugs. Replace 'airfield_slug' and 'aircraft_slug' 
# with your actual entity IDs (e.g. 'sensor.popham_carb_risk').

title: Hangar Assistant
views:
  - title: Hangar Overview
    icon: mdi:home-group
    type: sections
    max_columns: 3
    sections:
      - title: Quick Status
        cards:
          - type: custom:mushroom-chips-card
            chips:
              - type: template
                content: "Data Age: {{ states('sensor.airfield_slug_weather_data_age') }}m"
                icon: mdi:clock-outline
                icon_color: "{{ 'green' if states('sensor.airfield_slug_weather_data_age')|int < 30 else 'red' }}"
              - type: template
                content: "Density Alt: {{ states('sensor.airfield_slug_density_altitude') }}ft"
                icon: mdi:elevation-rise
              - type: template
                content: >-
                  {% set mins = states('sensor.airfield_slug_daylight_countdown') | int(0) %}
                  {% set phase = state_attr('sensor.airfield_slug_daylight_countdown', 'phase') %}
                  {{ 'Daylight' if phase == 'day' else 'Daylight Starts' }}: {{ mins }}m
                icon: mdi:weather-sunset-down
                icon_color: >-
                  {% set mins = states('sensor.airfield_slug_daylight_countdown') | int(0) %}
                  {% if mins < 45 %}red{% elif mins < 90 %}amber{% else %}green{% endif %}

      - title: Primary Airfield Briefing
        cards:
          - type: custom:mushroom-template-card
            primary: "RECOMMENDED RUNWAY"
            secondary: >-
              {% set rwy = states('sensor.airfield_slug_best_runway') %}
              {% set xw = state_attr('sensor.airfield_slug_best_runway', 'crosswind_component') | float(0) %}
              RWY {{ rwy }} | {{ xw }}kt Crosswind
            icon: mdi:airport
            icon_color: "{{ 'green' if xw < 12 else 'orange' if xw < 15 else 'red' }}"
            tap_action:
              action: more-info
            entity: sensor.airfield_slug_best_runway

          - type: grid
            columns: 2
            square: false
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.airfield_slug_carb_risk
                name: Carb Icing
                icon_color: "{{ state_attr('sensor.airfield_slug_carb_risk', 'color') }}"
              - type: custom:mushroom-entity-card
                entity: sensor.airfield_slug_icing_advisory
                name: Icing Advisory
                icon: mdi:snowflake-alert
                icon_color: >-
                  {% set sev = state_attr('sensor.airfield_slug_icing_advisory', 'severity') %}
                  {% if sev == 'warning' %}red{% elif sev == 'caution' %}amber{% else %}green{% endif %}
              - type: custom:mushroom-entity-card
                entity: sensor.airfield_slug_est_cloud_base
                name: Cloud Base
                icon: mdi:cloud-upload
          - type: markdown
            title: AI Pre-flight Briefing
            content: "{{ state_attr('sensor.airfield_slug_ai_pre_flight_briefing', 'briefing') }}"

      - title: Map & Location
        cards:
          - type: map
            entities:
              - entity: sensor.airfield_slug_best_runway
            aspect_ratio: "16:9"
            default_zoom: 14

  - title: Pre-Flight Calculator
    icon: mdi:calculator
    type: sections
    sections:
      - title: Weight & Performance
        cards:
          - type: markdown
            content: >
              ### Performance Calculation
              Adjust passenger/cargo loads to see impact on takeoff distance.
          
          # These entities require manual creation as Number Helpers in HA
          - type: entities
            entities:
              - entity: input_number.pilot_luggage_weight
                name: Pilot + Bag (kg)
              - entity: input_number.passenger_weight
                name: Passenger (kg)

          - type: custom:mushroom-template-card
            primary: "Calculated Ground Roll"
            secondary: "{{ states('sensor.aircraft_slug_calculated_ground_roll') }}m (MTOW)"
            icon: mdi:ruler-square
            icon_color: blue
            
          - type: custom:mushroom-template-card
            primary: "50ft Clearance Dist"
            secondary: "{{ state_attr('sensor.aircraft_slug_calculated_ground_roll', 'poh_50ft_dist_m') }}m"
            icon: mdi:tree
            icon_color: green

  - title: Compliance & Logs
    icon: mdi:file-document-outline
    type: sections
    sections:
      - title: Records
        cards:
          - type: custom:mushroom-template-card
            primary: "CAP 1590B Declaration"
            secondary: "Generate Cost Sharing Form"
            icon: mdi:file-sign
            icon_color: purple
            tap_action:
              action: call-service
              service: hangar_assistant.manual_cleanup # Replace with PDF service when ready
